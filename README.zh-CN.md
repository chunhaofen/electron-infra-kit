# Electron Infra Kit

[![npm version](https://img.shields.io/npm/v/electron-infra-kit.svg)](https://www.npmjs.com/package/electron-infra-kit)
[![npm downloads](https://img.shields.io/npm/dm/electron-infra-kit.svg)](https://www.npmjs.com/package/electron-infra-kit)
[![CI](https://github.com/chunhaofen/electron-infra-kit.git/actions/workflows/ci.yml/badge.svg)](https://github.com/chunhaofen/electron-infra-kit.git/actions/workflows/ci.yml)
[![License](https://img.shields.io/npm/l/electron-infra-kit.svg)](https://github.com/chunhaofen/electron-infra-kit.git/blob/main/LICENSE)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue.svg)](https://www.typescriptlang.org/)

[English](./README.md) | ç®€ä½“ä¸­æ–‡

ä¸º Electron åº”ç”¨æ‰“é€ çš„ç»¼åˆåŸºç¡€è®¾æ–½å·¥å…·åŒ…ï¼Œæä¾›çª—å£ç®¡ç†ã€IPC è·¯ç”±å’ŒçŠ¶æ€åŒæ­¥åŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- ğŸªŸ **çª—å£ç®¡ç†å™¨** - ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€çŠ¶æ€æŒä¹…åŒ–ã€æ’ä»¶ç³»ç»Ÿ
- ğŸ”Œ **IPC è·¯ç”±** - ç±»å‹å®‰å…¨çš„é€šä¿¡ï¼Œæ”¯æŒä¾èµ–æ³¨å…¥
- ğŸŒ‰ **æ¶ˆæ¯æ€»çº¿** - åŸºäº MessageChannel çš„è·¨çª—å£å®æ—¶çŠ¶æ€åŒæ­¥
- âš™ï¸ **é…ç½®ç®¡ç†å™¨** - æŒä¹…åŒ–é…ç½®ï¼Œæ”¯æŒ Zod éªŒè¯
- ğŸ› **è°ƒè¯•å·¥å…·** - æ€§èƒ½ç›‘æ§å’Œå¼€å‘å·¥å…·
- ğŸ“‹ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒå’Œè¿è¡Œæ—¶éªŒè¯

## ğŸ“¦ å®‰è£…

```bash
npm install electron-infra-kit
# æˆ–
pnpm add electron-infra-kit
```

**ä¾èµ–è¦æ±‚**: Electron >= 22.0.0, TypeScript >= 5.0.0, Node.js >= 18.0.0

## ğŸš€ å¿«é€Ÿå¼€å§‹

```typescript
import { app } from 'electron';
import { createElectronToolkit } from 'electron-infra-kit';

app.whenReady().then(async () => {
  // åˆå§‹åŒ–å·¥å…·åŒ…
  const { windowManager, ipcRouter, messageBus } = createElectronToolkit({
    isDevelopment: process.env.NODE_ENV === 'development',
  });

  // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
  await windowManager.ready();

  // åˆ›å»ºçª—å£
  await windowManager.create({
    name: 'main',
    title: 'æˆ‘çš„åº”ç”¨',
    width: 1024,
    height: 768,
  });
});
```

**å°±è¿™ä¹ˆç®€å•ï¼** ä½ ç°åœ¨æ‹¥æœ‰ï¼š

- âœ… å¸¦çŠ¶æ€æŒä¹…åŒ–çš„çª—å£ç®¡ç†
- âœ… ç±»å‹å®‰å…¨çš„ IPC é€šä¿¡
- âœ… è·¨çª—å£çŠ¶æ€åŒæ­¥
- âœ… æ€§èƒ½ç›‘æ§ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

## ğŸ“– æ–‡æ¡£

### å…¥é—¨æŒ‡å—

- **[å¿«é€Ÿå¼€å§‹](./QUICKSTART.zh-CN.md)** - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- **[å®Œæ•´ç¤ºä¾‹](./guides/COOKBOOK.zh-CN.md)** - åŒ…å«æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´ç¤ºä¾‹
- **[è¿ç§»æŒ‡å—](./IMPROVEMENTS.md)** - ä»æ—§ç‰ˆæœ¬å‡çº§

### æ ¸å¿ƒæ¦‚å¿µ

- **[çª—å£ç®¡ç†å™¨](./guides/core/window/README.zh-CN.md)** - çª—å£ç”Ÿå‘½å‘¨æœŸå’Œç®¡ç†
- **[IPC è·¯ç”±](./guides/core/ipc/README.zh-CN.md)** - ç±»å‹å®‰å…¨çš„è¿›ç¨‹é—´é€šä¿¡
- **[æ¶ˆæ¯æ€»çº¿](./guides/core/message-bus/README.zh-CN.md)** - çŠ¶æ€åŒæ­¥
- **[ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨](./guides/core/lifecycle/README.zh-CN.md)** - åº”ç”¨ç”Ÿå‘½å‘¨æœŸ

### è¿›é˜¶ä¸»é¢˜

- **[ç±»å‹å®‰å…¨æŒ‡å—](./guides/type-safety/TYPE_SAFETY.zh-CN.md)** - TypeScript æœ€ä½³å®è·µ
- **[æ€§èƒ½ä¼˜åŒ–](./guides/performance/PERFORMANCE.zh-CN.md)** - æŠ€å·§å’Œçªé—¨
- **[é”™è¯¯å¤„ç†](./guides/infrastructure/errors/ERROR_HANDLING.zh-CN.md)** - å¥å£®çš„é”™è¯¯ç®¡ç†
- **[è°ƒè¯•](./guides/infrastructure/debug/README.zh-CN.md)** - å¼€å‘å·¥å…·

### API å‚è€ƒ

- **[å®Œæ•´ API æ–‡æ¡£](./guides/README.zh-CN.md)** - å®Œæ•´çš„ API å‚è€ƒ
- **[ç±»å‹å®šä¹‰](./src/types.ts)** - TypeScript ç±»å‹

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

### çª—å£ç®¡ç†å™¨

<details>
<summary><b>æ¶æ„å›¾</b></summary>

```
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   WindowStore     â”‚
                                  â”‚   (æ ¸å¿ƒé—¨é¢)       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                â–¼               â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Registry  â”‚   â”‚  Operator  â”‚  â”‚ StateManager â”‚  â”‚ ContextMgr   â”‚
    â”‚  (å­˜å‚¨)     â”‚   â”‚  (æ“ä½œ)     â”‚  â”‚  (æŒä¹…åŒ–)     â”‚  â”‚ (ä¸Šä¸‹æ–‡æ•°æ®)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                            â–²
                                            â”‚ ç»„åˆ
                                            â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   WindowManager   â”‚
                                  â”‚   (é«˜çº§ API)       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚   Plugins    â”‚
                                     â”‚ & Lifecycle  â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

```typescript
// åˆ›å»ºå’Œç®¡ç†çª—å£
const windowId = await windowManager.create({
  name: 'editor',
  width: 800,
  height: 600,
});

// å…³é—­çª—å£ï¼ˆæ–°çš„ç»Ÿä¸€ APIï¼‰
windowManager.close(windowId);
```

### IPC è·¯ç”±

<details>
<summary><b>æ¶æ„å›¾</b></summary>

```
æ¸²æŸ“è¿›ç¨‹ (Renderer)                   ä¸»è¿›ç¨‹ (Main)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      â”‚          â”‚                                     â”‚
â”‚  ipcRenderer.invoke  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ipcMain.handle('channel')          â”‚
â”‚   (name, data)       â”‚          â”‚            â”‚                        â”‚
â”‚                      â”‚          â”‚            â–¼                        â”‚
â”‚                      â”‚          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                      â”‚          â”‚      â”‚  IpcRouter  â”‚                â”‚
â”‚                      â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                      â”‚          â”‚            â”‚                        â”‚
â”‚                      â”‚          â”‚    1. éªŒè¯è¯·æ±‚ (Zod)                 â”‚
â”‚                      â”‚          â”‚    2. æŸ¥æ‰¾å¤„ç†å™¨ ('name')            â”‚
â”‚                      â”‚          â”‚    3. æ³¨å…¥ API (DI å®¹å™¨)             â”‚
â”‚                      â”‚          â”‚            â”‚                        â”‚
â”‚                      â”‚          â”‚            â–¼                        â”‚
â”‚                      â”‚          â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                      â”‚          â”‚      â”‚ IpcHandler  â”‚                â”‚
â”‚                      â”‚          â”‚      â”‚  (ä¸šåŠ¡é€»è¾‘)  â”‚â—„â”€â”€ APIs        â”‚
â”‚                      â”‚          â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                      â”‚          â”‚            â”‚                        â”‚
â”‚                      â”‚          â”‚            â–¼                        â”‚
â”‚                      â”‚          â”‚       è¿”å›ç»“æœ                       â”‚
â”‚                      â”‚          â”‚    (Promise<Result>)                â”‚
â”‚                      â”‚          â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

```typescript
// å®šä¹‰ç±»å‹å®‰å…¨çš„å¤„ç†å™¨
const handler = new IpcHandler(
  'getUser',
  'user',
  async (context, payload: { id: string }) => {
    return { id: payload.id, name: 'ç”¨æˆ·' };
  },
  z.object({ id: z.string() })
);

ipcRouter.addHandler(handler);
```

### æ¶ˆæ¯æ€»çº¿

<details>
<summary><b>æ¶æ„å›¾</b></summary>

```
       ä¸»è¿›ç¨‹ (Main)                         æ¸²æŸ“è¿›ç¨‹ (Renderer)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MessageBus          â”‚          â”‚       çª—å£ A         â”‚
â”‚        (å…±äº«å®ä¾‹)            â”‚          â”‚ (MessagePort Client) â”‚
â”‚                             â”‚â—„â”€â”€IPCâ”€â”€â”€â”€â”¤                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚      æœ¬åœ°ç¼“å­˜         â”‚
â”‚  â”‚ DataStore (Map)       â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ - key: value          â”‚  â”‚                     â”‚
â”‚  â”‚ - permission          â”‚  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚
â”‚             â”‚               â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚       çª—å£ B         â”‚
â”‚  â”‚ MessageDispatcher     â”‚â”€â”€â”¼â”€å¹¿æ’­â”€â”€â”€â”€â”€â”‚ (MessagePort Client) â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
â”‚             â”‚               â”‚          â”‚      æœ¬åœ°ç¼“å­˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ WindowPorts (Map)     â”‚  â”‚
â”‚  â”‚ - winId: MessagePort  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

```typescript
// è·¨çª—å£åŒæ­¥çŠ¶æ€
messageBus.setData('theme', 'dark');

// ç›‘å¬å˜åŒ–ï¼ˆè®°å¾—å–æ¶ˆè®¢é˜…ï¼ï¼‰
const unsubscribe = messageBus.watch('theme', (newValue) => {
  console.log('ä¸»é¢˜å˜æ›´:', newValue);
});
```

## ğŸ¯ é€‚ç”¨åœºæ™¯

- **å¤šçª—å£ IDE** - å¸¦æœ‰å¤šä¸ªé¢æ¿çš„ä»£ç ç¼–è¾‘å™¨
- **è®¾è®¡å·¥å…·** - åŒ…å«ç”»å¸ƒã€å±æ€§å’Œå·¥å…·æ çš„åº”ç”¨
- **åä½œåº”ç”¨** - è·¨çª—å£å®æ—¶çŠ¶æ€åŒæ­¥
- **ä¼ä¸šåº”ç”¨** - å…·æœ‰å¤æ‚å·¥ä½œæµçš„å¤§å‹åº”ç”¨

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LifecycleManager                â”‚
â”‚         (ç¼–æ’æ‰€æœ‰æ¨¡å—)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Window  â”‚â—„â”€â”¤   IPC   â”‚â—„â”€â”¤ Message â”‚
â”‚ Manager â”‚  â”‚ Router  â”‚  â”‚   Bus   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡åŸåˆ™**:

- ğŸ¯ å…³æ³¨ç‚¹åˆ†ç¦» - æ¯ä¸ªæ¨¡å—éƒ½æœ‰å•ä¸€èŒè´£
- ğŸ”’ ç±»å‹å®‰å…¨ä¼˜å…ˆ - å®Œæ•´çš„ TypeScript æ”¯æŒå’Œè¿è¡Œæ—¶éªŒè¯
- âš¡ æ€§èƒ½ä¼˜åŒ– - åŸºäº MessageChannel çš„é€šä¿¡
- ğŸ”Œ å¯æ‰©å±• - æ’ä»¶ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠŸèƒ½
- ğŸ›¡ï¸ é»˜è®¤å®‰å…¨ - ä¸Šä¸‹æ–‡éš”ç¦»å’Œæ²™ç®±æœºåˆ¶

## ğŸ“‚ ç›®å½•ç»“æ„

```
electron-infra-kit/
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ window/         # çª—å£ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ipc/            # IPC è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ message-bus/    # æ¶ˆæ¯æ€»çº¿
â”‚   â”‚   â””â”€â”€ lifecycle/      # ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨
â”‚   â”œâ”€â”€ infrastructure/     # åŸºç¡€è®¾æ–½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ debug/          # è°ƒè¯•å·¥å…·
â”‚   â”‚   â”œâ”€â”€ errors/         # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ logger/         # æ—¥å¿—è®°å½•
â”‚   â””â”€â”€ preload/            # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ examples/               # ç¤ºä¾‹é¡¹ç›®
â””â”€â”€ guides/                 # æ–‡æ¡£æŒ‡å—
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [DEVELOPMENT.md](./DEVELOPMENT.md) äº†è§£ï¼š

- å¼€å‘ç¯å¢ƒè®¾ç½®
- ä»£ç è§„èŒƒ
- æäº¤è§„èŒƒ
- å‘å¸ƒæµç¨‹

## ğŸ“„ è®¸å¯è¯

[MIT](./LICENSE) Â© [chunhaofen](https://github.com/chunhaofen)

---

## ğŸ”— é“¾æ¥

- **[GitHub ä»“åº“](https://github.com/chunhaofen/electron-infra-kit)**
- **[npm åŒ…](https://www.npmjs.com/package/electron-infra-kit)**
- **[é—®é¢˜è¿½è¸ª](https://github.com/chunhaofen/electron-infra-kit/issues)**
- **[æ›´æ–°æ—¥å¿—](./CHANGELOG.md)**

## â­ Star å†å²

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™å®ƒä¸€ä¸ª starï¼â­

---

**ç”¨ â¤ï¸ ä¸º Electron ç¤¾åŒºæ‰“é€ **
